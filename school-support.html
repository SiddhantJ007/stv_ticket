<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 connect-src https://api.lexaib2b.com;
                 img-src 'self' data:;
                 font-src https://fonts.gstatic.com;
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 script-src 'self' 'unsafe-inline';
                 base-uri 'none';
                 frame-ancestors 'none'">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Saint Vincent Ferrer School ‚Äî Helpdesk Tickets</title>

  <!-- Brand fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --svf-blue:#1f4ea8; --svf-blue-dark:#0f2f6d;
      --svf-gold:#d4af37; --svf-gold-soft:#f6d878;
      --bg:#f7fafc; --bg2:#ffffff; --text:#0f1b2d; --muted:#5b6b86;
      --panel:#ffffff; --panel-2:#fbfdff; --border:#e1e9f8;
      --ring:rgba(31,78,168,.22);
    }
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--text);
      font:16px/1.55 'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(900px 200px at 15% -10%, rgba(212,175,55,.12), transparent 60%),
        radial-gradient(900px 200px at 85% -10%, rgba(31,78,168,.10), transparent 60%),
        linear-gradient(180deg,var(--bg),var(--bg2));
      min-height:100vh;
    }
    a{color:var(--svf-blue);text-decoration:none}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
    .brand-bar{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:8px}
    .svf-logo{width:84px;height:84px;object-fit:contain;filter:drop-shadow(0 2px 4px rgba(0,0,0,.08))}
    h1,h2,h3{font-family:"Playfair Display",serif;text-align:center;color:var(--svf-blue-dark)}
    h1{margin:0;font-size:40px;font-weight:800;letter-spacing:.2px;line-height:1.1}
    .sub{text-align:center;color:var(--muted);margin:8px 0 16px;font-weight:600}
    .brand-rule{width:120px;height:4px;border-radius:2px;margin:10px auto 0;
      background:linear-gradient(90deg,var(--svf-gold),var(--svf-gold-soft))}
    .hero{
      background:
        radial-gradient(600px 120px at 50% -20%, rgba(212,175,55,.12), transparent 65%),
        linear-gradient(180deg,#ffffff,#ffffffcc);
      border:1px solid var(--border);border-radius:18px;padding:24px 18px;
      box-shadow:0 14px 34px rgba(15,47,109,.08)
    }
    .grid{display:grid;gap:18px;grid-template-columns:1fr}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;
      box-shadow:0 6px 14px rgba(15,47,109,.06)}
    .section-title{display:flex;align-items:center;justify-content:center;text-align:center;width:100%;
      margin:.2rem auto .6rem;color:var(--svf-blue);font-weight:700;letter-spacing:.2px}
    .label{display:block;color:#213455;margin:10px 0 6px;font-size:13px;font-weight:700}
    input,textarea,select{
      width:100%;background:#fff;color:#0f172a;border:2px solid var(--svf-blue);border-radius:12px;
      padding:12px 13px;outline:none;transition:.15s box-shadow,.15s border-color;
      box-shadow:0 1px 0 rgba(15,27,45,.02) inset
    }
    input:focus,textarea:focus,select:focus{border-color:var(--svf-blue);box-shadow:0 0 0 4px rgba(212,175,55,.25)}
    textarea{min-height:130px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:560px){.row{grid-template-columns:1fr}}
    .inline-check{display:flex;align-items:center;gap:.6rem;margin-top:10px;padding:10px 12px;background:var(--panel-2);
      border:1px dashed #cfe0ff;border-radius:12px}
    .inline-check input{width:18px;height:18px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(31,78,168,.4);
      background:linear-gradient(180deg,#ffffff,#f7faff);color:var(--svf-blue-dark);padding:10px 16px;border-radius:12px;
      cursor:pointer;font-weight:800;letter-spacing:.2px}
    .btn.primary{border-color:var(--svf-blue);background:linear-gradient(180deg,#2f67d6,#1f4ea8);color:#fff;
      box-shadow:0 8px 18px rgba(31,78,168,.28)}
    .btn.primary:hover{filter:brightness(1.03)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .note{color:#6b7a96;font-size:13px}
    .msg{margin-top:12px}
    .success{color:#0b3a2a;background:#f2fbf6;border:1px solid #c5f3dc;padding:12px;border-radius:10px}
    .error{color:#702020;background:#fff2f2;border:1px solid #ffd2d2;padding:12px;border-radius:10px}
    .spinner{width:16px;height:16px;border:2px solid #dbe7ff;border-top-color:#fff;border-right-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .help-row{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:10px;flex-wrap:wrap}

    /* Branded select skin; custom menu */
    .brand-select{
      appearance:none;-webkit-appearance:none;-moz-appearance:none;color:#0f1b2d;border:2px solid var(--svf-blue);
      border-radius:12px;padding:12px 44px 12px 13px;
      background:url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2218%22 height=%2218%22 viewBox=%220 0 24 24%22><path fill=%22%231f4ea8%22 d=%22M7 10l5 5 5-5z%22/></svg>') no-repeat right 12px center/18px 18px,
                 linear-gradient(180deg,#fff,#fbfdff);
      box-shadow:0 1px 0 rgba(15,47,109,.04) inset
    }
    .brand-select:focus{outline:none;border-color:var(--svf-blue);box-shadow:0 0 0 4px rgba(212,175,55,.25)}
    .brand-select::-ms-expand{display:none}
    .brand-select option{color:#0f1b2d;background:#fff}

    .svf-select{position:relative;font:inherit}
    .svf-select-hidden{position:absolute;inset:0;width:100%;height:100%;opacity:0;pointer-events:none}
    .svf-select-btn{width:100%;border:2px solid var(--svf-blue);border-radius:12px;background:linear-gradient(180deg,#ffffff,#fbfdff);
      color:#0f1b2d;padding:12px 44px 12px 13px;text-align:left;cursor:pointer;position:relative;box-shadow:0 1px 0 rgba(15,47,109,.06) inset}
    .svf-select-btn:focus-visible{outline:none;box-shadow:0 0 0 4px rgba(212,175,55,.25)}
    .svf-select-btn::after{content:"";position:absolute;right:12px;top:50%;transform:translateY(-50%);width:18px;height:18px;
      background:url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2218%22 height=%2218%22 viewBox=%220 0 24 24%22><path fill=%22%231f4ea8%22 d=%22M7 10l5 5 5-5z%22/></svg>') no-repeat center/18px 18px}
    .svf-menu{position:absolute;left:0;right:0;z-index:50;margin-top:6px;background:var(--svf-blue-dark);border:2px solid var(--svf-blue);
      border-radius:12px;box-shadow:0 14px 28px rgba(15,47,109,.18);overflow:hidden;display:none}
    .svf-menu.open{display:block}
    .svf-option{padding:10px 12px;cursor:pointer;color:#fff;display:flex;align-items:center;gap:10px}
    .svf-option+.svf-option{border-top:1px solid rgba(255,255,255,.08)}
    .svf-option:hover,.svf-option[aria-selected="true"]{color:var(--svf-blue-dark);background:var(--svf-gold)}
    .svf-dot{width:10px;height:10px;border-radius:50%;box-shadow:0 0 0 2px rgba(255,255,255,.6) inset}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <div class="brand-bar">
        <a href="https://www.stvfschool.org/"><img class="svf-logo" src="svf-crest.png" alt="Saint Vincent Ferrer School crest"></a>
        <h1>Saint Vincent Ferrer School</h1>
      </div>
      <div class="brand-rule"></div>

      <div class="grid">
        <form id="tForm" class="card" autocomplete="on">
          <h2 class="section-title">Submit a Ticket</h2>
          <p class="sub" style="margin-top:-4px">Fill in the details. Clear, short sentences work best!</p>

          <div class="row">
            <div>
              <label class="label">Your name *</label>
              <input id="name" required placeholder="First &amp; last name"/>
            </div>
            <div>
              <label class="label">Your email *</label>
              <input id="email" type="email" required placeholder="you@example.com"/>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="label">Role</label>
              <select id="role" class="brand-select" aria-label="Role">
                <option>Faculty/Staff</option><option>Student</option><option>Parent</option>
              </select>
            </div>
            <div>
              <label class="label">Urgency *</label>
              <select id="urgency" required aria-label="Urgency">
                <option value="low">üü¢ Low ‚Äî not urgent</option>
                <option value="normal" selected>üü° Normal</option>
                <option value="high">üü† High ‚Äî soon</option>
                <option value="critical">üî¥ Critical ‚Äî now</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="label">Category</label>
              <select id="category" class="brand-select" aria-label="Category">
                <option selected>Hardware (i.e Cleartouch, Printer, Surface Laptop, Docucam, Speaker)</option>
                <option>Software (i.e network connection, login, edtech software install, Google integration)</option>
                <option>Presentation Setup</option>
                <option>Technical Issue (i.e. frozen screen, unblock website)</option>
                <option>Google Support (i.e. stvfemail)</option>
                <option>Microsoft Support (i.e. Teams, Word, Excel, etc.)</option>
                <option>Other</option>
              </select>
            </div>
            <div>
              <label class="label">Subject *</label>
              <input id="subject" required placeholder="Short summary (e.g., Chromebook won‚Äôt turn on)"/>
            </div>
          </div>

          <label class="label">Message *</label>
          <textarea id="message" required placeholder="Describe the issue‚Ä¶ What happened? When did it start? Any details help!"></textarea>

          <label class="inline-check">
            <input type="checkbox" id="send_copy" />
            <span>Email me a copy</span>
          </label>

          <div class="help-row">
            <button class="btn primary" id="submitBtn" type="submit">
              <span class="spinner" id="spin" style="display:none"></span>
              Submit ticket
            </button>
            <button class="btn" type="button" id="clearBtn">Clear</button>
            <span class="note">We‚Äôll email the helpdesk and log your ticket.</span>
          </div>
          <div class="msg" id="formMsg"></div>
        </form>
      </div>
    </section>
  </div>

  <script>
    const API_BASE = (()=> {
      const h = location.hostname;
      if (h === "localhost" || h === "127.0.0.1") return "http://127.0.0.1:8000";
      return "https://api.lexaib2b.com";
    })();
    const api = (p)=>`${API_BASE}${p}`;

    const f = id=>document.getElementById(id);
    const tForm = f('tForm'), submitBtn=f('submitBtn'), spin=f('spin'), formMsg=f('formMsg'), clearBtn=f('clearBtn');

    clearBtn.addEventListener('click', ()=>{tForm.reset(); formMsg.innerHTML='';});

    tForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      formMsg.innerHTML='';

      const emailVal = f('email').value.trim();
      const payload = {
        name: f('name').value.trim(),
        email: emailVal,
        role: f('role').value.trim(),
        subject: f('subject').value.trim(),
        message: f('message').value.trim(),
        urgency: f('urgency').value,
        category: f('category')?.value.trim() || 'Other',
        send_copy: document.getElementById('send_copy').checked
      };

      const errs = [];
      if(payload.name.length < 2) errs.push('Please enter a valid name!');
      if(!/^[^@]+@[^@]+\.[^@]+$/.test(payload.email)) errs.push('Please enter a valid email!');
      if(payload.subject.length < 2) errs.push('Please enter a slightly detailed subject!');
      if(payload.message.length < 5) errs.push('Please elaborate your issue!');
      if(!payload.urgency) errs.push('Please pick an urgency!');
      if(errs.length){ formMsg.innerHTML = `<div class="error">${errs.join(' ')}</div>`; return; }

      submitBtn.disabled=true; spin.style.display='inline-block';
      try{
        const r = await fetch(api('/api/school/ticket'), {
          method:'POST',
          headers:{
            'Content-Type':'application/json',
            'X-Tenant':'svf'                 // helps you segment logs/rate limits
          },
          body: JSON.stringify(payload)
        });
        if(!r.ok){
          let msg = `HTTP ${r.status} ${r.statusText}`;
          try{ const j = await r.json(); if(j.detail) msg += ` ‚Äì ${j.detail}`; }catch{}
          throw new Error(msg);
        }
        const data = await r.json();
        formMsg.innerHTML = `<div class="success">‚úÖ Ticket submitted. ID: <b>${data.id}</b>. We‚Äôve emailed the helpdesk.</div>`;
        tForm.reset();
      }catch(err){
        formMsg.innerHTML = `<div class="error">‚ùå ${err.message}</div>`;
      }finally{
        submitBtn.disabled=false; spin.style.display='none';
      }
    });

    (function(){ const e = document.getElementById('email'); if(e) e.focus(); })();
  </script>

  <script>
    (function(){
      document.getElementById('role')?.classList.add('brand-select');
      document.getElementById('category')?.classList.add('brand-select');
    })();
  </script>

  <script>
    (function(){
      function enhanceSelect(sel){
        if(!sel || sel.dataset.svfEnhanced) return;
        sel.dataset.svfEnhanced = "1";
        const wrap = document.createElement('div'); wrap.className='svf-select';
        sel.parentNode.insertBefore(wrap, sel); wrap.appendChild(sel);
        sel.classList.add('svf-select-hidden');

        const btn=document.createElement('button');
        btn.type='button'; btn.className='svf-select-btn';
        btn.setAttribute('aria-haspopup','listbox'); btn.setAttribute('aria-expanded','false');
        btn.textContent = sel.options[sel.selectedIndex]?.text || ''; wrap.appendChild(btn);

        const menu=document.createElement('div'); menu.className='svf-menu'; menu.setAttribute('role','listbox'); wrap.appendChild(menu);

        Array.from(sel.options).forEach((op, idx)=>{
          const item=document.createElement('div'); item.className='svf-option'; item.setAttribute('role','option'); item.setAttribute('tabindex','-1');
          item.dataset.value = op.value || op.text;
          if (sel.id === 'urgency') {
            const dot=document.createElement('span'); dot.className='svf-dot';
            const v=(op.value||'').toLowerCase();
            dot.style.background=(v==='low'?'#16a34a':v==='normal'?'#f59e0b':v==='high'?'#ea580c':v==='critical'?'#ef4444':'#9ca3af');
            item.appendChild(dot);
          }
          const span=document.createElement('span'); span.textContent=op.text; item.appendChild(span);
          if(idx===sel.selectedIndex) item.setAttribute('aria-selected','true');
          item.addEventListener('click', ()=>choose(item));
          item.addEventListener('mousemove', ()=>focusItem(idx));
          menu.appendChild(item);
        });

        let focused=sel.selectedIndex||0;
        function open(){ menu.classList.add('open'); btn.setAttribute('aria-expanded','true'); focusItem(focused);
          document.addEventListener('click',onDoc,true); document.addEventListener('keydown',onKey); }
        function close(){ menu.classList.remove('open'); btn.setAttribute('aria-expanded','false');
          document.removeEventListener('click',onDoc,true); document.removeEventListener('keydown',onKey); }
        function onDoc(e){ if(!wrap.contains(e.target)) close(); }
        function onKey(e){
          const max=sel.options.length-1;
          if(e.key==='Escape'){ close(); btn.focus(); }
          else if(e.key==='ArrowDown'){ e.preventDefault(); focusItem(Math.min(max,focused+1)); }
          else if(e.key==='ArrowUp'){ e.preventDefault(); focusItem(Math.max(0,focused-1)); }
          else if(e.key==='Enter' || e.key===' '){ e.preventDefault(); choose(menu.children[focused]); }
        }
        function focusItem(i){ focused=i; Array.from(menu.children).forEach((n,idx)=>{ n.classList.toggle('hover',idx===i); if(idx===i) n.focus(); }); }
        function choose(item){
          Array.from(menu.children).forEach(n=>n.removeAttribute('aria-selected'));
          item.setAttribute('aria-selected','true');
          sel.value = item.dataset.value; btn.textContent=item.textContent; sel.dispatchEvent(new Event('change',{bubbles:true}));
          close(); btn.focus();
        }
        btn.addEventListener('click', ()=>{ menu.classList.contains('open')?close():open(); });
        sel.addEventListener('change', ()=>{ const idx=sel.selectedIndex;
          if(idx>=0){ btn.textContent=sel.options[idx].text; Array.from(menu.children).forEach((n,i)=> n.toggleAttribute('aria-selected', i===idx)); }});
      }
      ['role','category','urgency'].forEach(id=>enhanceSelect(document.getElementById(id)));
    })();
  </script>
</body>
</html>
